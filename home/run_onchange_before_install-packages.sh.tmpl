#!/bin/sh

# Install homebrew if it doesn't exist yet
if [ -z "$(which brew)" ]; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> $HOME/.zprofile
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# Install packages
brew install \
  zsh \
  tmux \
  fzf \
  ripgrep \
  fd \
  eza \
  wget \
  btop \
  git \
  git-flow \
  yt-dlp \
  mise \
  zoxide \
  gh \
  neovim \
  atuin \
  starship \
  forgit \
  syncthing

brew services restart syncthing

# Install casks
{{ if .casks -}}
brew install \
  firefox \
  ghostty \
  spotify \
  fantastical \
  mimestream \
  obsidian \
  discord \
  alfred \
  1password \
  1password-cli
{{ end -}}

# Desktop-specific packages (brew, casks, fonts, mas apps)
{{ if .desktop -}}
brew install \
  linearmouse \
  betterdisplay \
  rectangle-pro
{{ end -}}

# Install fonts
brew install font-iosevka-nerd-font-mono

# Antidote for zsh
git clone --depth=1 https://github.com/mattmc3/antidote.git ${ZDOTDIR:-~}/.antidote

# Install TPM for tmux
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Mise setup
brew install libyaml # Ruby dependency
mise install

# Mac App Store apps
brew install mas
mas install 1435957248    # Drafts
mas install 1475387142    # Tailscale
mas install 1542143627    # Omnifocus

# fzf shell completion/keybindings setup
/opt/homebrew/opt/fzf/install --all --no-bash --no-fish
