labels:
  # Size labels
  size-small:
    name: "size:small"
    description: "Used for small pull requests"
    color: "#91cf60"
  size-medium:
    name: "size:medium"
    description: "Used for medium pull requests"
    color: "#ffffbf"
  size-large:
    name: "size:large"
    description: "Used for large pull requests"
    color: "#fc8d59"

  # PR-type labels
  type-bugfix:
    name: "type:bugfix"
    description: "Provides a bug fix"
    color: "#fdae61"
  type-feature:
    name: "type:feature"
    description: "Provides a new feature"
    color: "#2c7bb6"

rules:
  # Size-relateed rules
  - name: is-small
    kind: patch
    description: Small pull request
    spec: $size() <= 30

  - name: is-medium
    kind: patch
    description: Medium-sized pull request
    spec: $size() > 30 && $size() <= 200

  - name: is-large
    kind: patch
    description: Large pull request
    spec: $size() > 200

  # PR-type rules:
  - name: is-feature
    kind: patch
    description: Is the pull request a ading a new feature?
    spec: '$startsWith($head(), "feature/")'

  - name: is-hotfix
    kind: patch
    description: Is the pull request for a bugfix/hotfix?
    spec: '$startsWith($head(), "hotfix/")'

  # Branch convention rules
  - name: avoid-circular-history
    kind: patch
    spec: "!$hasLinearHistory()"

workflows:
  # Assign a size label to pull requests based on change size
  - name: add-label-with-size
    description: Add label with size of the pull request
    always-run: true
    if:
      - rule: is-small
        extra-actions:
          - '$removeLabel("size-medium")'
          - '$removeLabel("size-large")'
          - '$addLabel("size-small")'
      - rule: is-medium
        extra-actions:
          - '$removeLabel("size-small")'
          - '$removeLabel("size-large")'
          - '$addLabel("size-medium")'
      - rule: is-large
        extra-actions:
          - '$removeLabel("size-small")'
          - '$removeLabel("size-medium")'
          - '$addLabel("size-large")'

  # Assign a type label based on the branch name
  - name: enforce-branch-naming
    if:
      - rule: is-hotfix
        extra-actions:
          - '$addLabel("type-bugfix")'
      - rule: is-feature
        extra-actions:
          - '$addLabel("type-feature")'

  # Avoid circular history
  - name: require-linear-history
    always-run: true
    if:
      - rule: avoid-circular-history
        extra-actions:
          - '$warn("Please help us keep our history tidy by avoiding circular history. See this SO thread for some discussion on the topic: https://stackoverflow.com/questions/20348629/what-are-advantages-of-keeping-linear-history-in-git")'

  # This workflow validates that pull requests follow the conventional commits specification.
  # This helps developers automatically generate changelogs.
  # For more details, see https://www.conventionalcommits.org/en/v1.0.0/.
  - name: check-conventional-commits
    description: Validate that pull requests follow the conventional commits
    always-run: true
    if:
      - rule: $isDraft() == false
    then:
      - $commitLint()
      - $titleLint()
